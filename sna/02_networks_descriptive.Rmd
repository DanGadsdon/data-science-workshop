---
title: "Social network analysis with R: node and network properties"
author: "Pablo Barbera"
date: "January 21, 2016"
output: html_document
---

```{r, echo=FALSE, message=FALSE}
library(igraph)
edges <- read.csv("data/star-wars-network-edges.csv")
nodes <- read.csv("data/star-wars-network-nodes.csv")
g <- graph_from_data_frame(d=edges, vertices=nodes, directed=TRUE)
```

#### Node properties

Measures of centrality/importance

Degree: how well-connected nodes are; a measure of direct influence

```{r}
sort(degree(g))
```

In directed graphs, indegree and outdegree, with `mode="in"` or `mode="out"`.

Strength is a weighted measure of degree.

```{r}
sort(strength(g))
```

Closeness measures how many steps are required to access every other node from a given node; it's a measure of how long information takes to arrive (who hears news first?). Higher values mean less centrality.

```{r}
sort(closeness(g))
```

Betweenness measures brokerage or gatekeeping potential. Approximately the number of shortest paths between nodes that pass through a particular node.

```{r}
sort(betweenness(g))
```

Eigenvector centrality: a measure of being connected to the well-connected. First eigenvector of the graph adjacency matrix. Only works with undirected networks.

```{r}
sort(eigen_centrality(g)$vector)
```

Page rank algorithm: approximates probability that any message would arrive to a particular node. Developed by Google founders, and originally applied to website links.

```{r}
sort(page_rank(g)$vector)
```

```{r}
sort(authority_score(g)$vector)
```

```{r}
neighbors(g, v=which(V(g)$name=="DARTH VADER"))
ego(g, order=2, nodes=which(V(g)$name=="DARTH VADER"))
```

#### Network properties

Size of the network
```{r}
diameter(g)
get_diameter(g)
mean_distance(g)
distances(g)
```

Density
```{r}
edge_density(g)
```

Reciprocity (only for directed graphs)
```{r}
reciprocity(g)
```

Transitivity or clustering coefficient
```{r}
transitivity(g)
```

#### Network communities

Connected components
```{r}
components(g)
giant <- decompose(g)[[1]]
```

Community detection: finding subsets of the network that are more connected to each other than to the rest of the network
```{r}
cluster_walktrap(g)
# Others
cluster_edge_betweenness(g)
#cluster_fast_greedy(g)
cluster_infomap(g)
cluster_label_prop(g)
```

Plotting communities
```{r}
comm <- cluster_walktrap(giant)
modularity(comm)
par(mar=c(0,0,0,0)); plot(comm, giant)
V(giant)$color <- membership(comm)
par(mar=c(0,0,0,0)); plot(giant)
```

K-core decomposition: core-periphery analysis. A k-core is a maximal group such that all nodes have at least degree K. This techniques informs us about the hierarchy of the network.
```{r, fig.height=5, figh.width=6}
coreness(g)
V(g)$coreness <- coreness(g)
par(mfrow=c(2, 3), mar=c(0.1,0.1,1,0.1))
set.seed(777); fr <- layout_with_fr(g)
for (k in 1:6){
  V(g)$color <- ifelse(V(g)$coreness>=k, "orange", "grey")
  plot(g, main=paste0(k, '-core shell'), layout=fr)
}

```

Backbone decomposition: subset of a weighted network that represents the most relevant connections, while maintaning its functionality. Common example: airport networks.
```{r}
#install.packages("disparityfilter")
library(disparityfilter)
gg <- get.backbone(g)
plot(gg)

```

